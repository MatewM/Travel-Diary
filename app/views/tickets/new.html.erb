<%= turbo_frame_tag "modal" do %>
  <div data-controller="upload"
       class="fixed inset-0 z-50 flex items-center justify-center p-4">

    <%# Backdrop — click cierra el modal %>
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"
         data-action="click->upload#close"
         aria-hidden="true"></div>

    <%# Panel %>
    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg transform transition-all">

      <%# Cabecera %>
      <div class="flex items-center justify-between px-6 pt-6 pb-4">
        <h3 class="text-lg font-semibold text-slate-900">Subir Billetes</h3>
        <button type="button"
                data-action="click->upload#close"
                class="text-slate-400 hover:text-slate-600 transition-colors rounded-lg p-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <%# Formulario %>
      <%= form_with model: @ticket, url: tickets_path, class: "px-6 pb-6" do |f| %>

        <%# Target de error — actualizado por Turbo Stream desde el controlador %>
        <div id="upload_form_errors"></div>

        <%# Zona de drag & drop %>
        <div data-upload-target="dropZone"
             data-action="dragover->upload#dragOver dragleave->upload#dragLeave drop->upload#dropFile click->upload#triggerFileInput"
             class="border-2 border-dashed border-slate-300 rounded-xl bg-slate-50
                    hover:border-indigo-400 hover:bg-indigo-50 transition-colors
                    cursor-pointer p-6 text-center select-none">

          <%# Icono upload — visible cuando no hay archivos seleccionados %>
          <div data-upload-target="uploadIcon">
            <svg class="w-10 h-10 text-slate-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <p class="text-sm font-medium text-slate-700">Arrastra tus billetes aquí</p>
            <p class="text-xs text-slate-400 mt-1">o haz clic para seleccionar</p>
            <p class="text-xs text-slate-400 mt-1">PDF · JPG · PNG · máx. 10 MB · múltiples archivos</p>
          </div>

          <%# Lista de archivos seleccionados — oculta por defecto %>
          <div data-upload-target="previewArea" class="hidden text-left">
            <p data-upload-target="counter"
               class="text-sm font-semibold text-slate-800 mb-3"></p>
            <div data-upload-target="fileList"
                 class="space-y-1 max-h-44 overflow-y-auto pr-1"></div>
            <p class="text-xs text-indigo-600 mt-3 text-center">Haz clic para cambiar los archivos</p>
          </div>

        </div>

        <%# Input file oculto — multiple: true, manejado por Stimulus %>
        <%= f.file_field :original_files,
              multiple: true,
              accept: "application/pdf,image/jpeg,image/png",
              class: "sr-only",
              data: { upload_target: "fileInput",
                      action: "change->upload#previewFiles" } %>

        <%# Botones %>
        <div class="flex justify-end gap-3 mt-5">
          <button type="button"
                  data-action="click->upload#close"
                  class="border border-slate-200 text-slate-700 rounded-lg px-4 py-2
                         text-sm font-medium hover:bg-slate-50 transition-colors">
            Cancelar
          </button>
          <%= f.submit "Subir",
                class: "bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-4 py-2
                        text-sm font-medium transition-colors cursor-pointer" %>
        </div>

      <% end %>
    </div>
  </div>
<% end %>
