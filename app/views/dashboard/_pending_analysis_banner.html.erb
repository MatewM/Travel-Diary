<% selected_year = session[:selected_year]&.to_i || Date.current.year %>
<% year_start = Date.new(selected_year, 1, 1) %>
<% year_end = Date.new(selected_year, 12, 31) %>
<% count = local_assigns.fetch(:pending_count) { 
  current_user.tickets
    .pending_parse
    .where(created_at: year_start.beginning_of_day..year_end.end_of_day)
    .count 
} %>
<% if count > 0 %>
  <div id="pending_analysis_banner"
       class="mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between
              gap-3 bg-indigo-50 border border-indigo-200 rounded-xl px-5 py-4">
    <div class="flex items-center gap-3">
      <span class="text-2xl">ğŸ“‹</span>
      <div>
        <p class="text-sm font-semibold text-indigo-800">
          Tienes <%= count %> billete<%= count > 1 ? "s" : "" %> pendiente<%= count > 1 ? "s" : "" %> de anÃ¡lisis
        </p>
        <p class="text-xs text-indigo-500 mt-0.5">
          La IA extraerÃ¡ automÃ¡ticamente los datos de cada billete.
        </p>
      </div>
    </div>
    <%= button_to "Analizar #{count} billete#{count > 1 ? 's' : ''}",
          process_tickets_tickets_path,
          method: :post,
          form: { data: { turbo_frame: "process_tickets_frame" } },
          class: "flex-shrink-0 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2
                  rounded-lg text-sm font-medium transition-colors shadow-sm shadow-indigo-200
                  whitespace-nowrap" %>
  </div>
<% else %>
  <div id="pending_analysis_banner" class="hidden"></div>
<% end %>
